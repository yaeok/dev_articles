---
title: "cloud firestoreã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¶ã¡è¾¼ã‚“ã¦ã¿ãŸ"
emoji: "ğŸ˜º"
type: "tech"
topics:
  - "firebase"
  - "cloudfirestore"
  - "googleappscript"
  - "spreadsheet"
published: true
published_at: "2023-08-19 15:31"
---

# ã¯ã˜ã‚ã«
æœ€è¿‘ã¯ãšã£ã¨firebaseã¨Next.jsã«ãŠä¸–è©±ã«ãªã£ã¦ã¾ã™ã€‚yappiã§ã™ã€‚
firebaseã®å°å…¥ã£ã¦ã©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒãƒ™ã‚¹ãƒˆãªã‚“ã ã‚ã†ã£ã¦ã„ã¤ã‚‚æ‚©ã¿ãªãŒã‚‰ã€ã„ã¤ã‚‚å®Ÿè£…ä¸­ç›¤ãã‚‰ã„ã§å°å…¥ã—ã¦ã¾ã™ã€‚ã¿ãªã•ã‚“ã¯ã©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚„ã£ã¦ã¾ã™ã‹ï¼Ÿ
å€‹äººçš„ã«ã¯ç™»éŒ²ã™ã‚‹é …ç›®ãŒ8å‰²å›ºã¾ã£ãŸã‚‰firebaseã„ã‚Œã‚ˆã†ã£ã¦æ„Ÿã˜ã§ã€è‡ªåˆ†çš„ã«ã¯ãƒ™ã‚¹ãƒˆã ã¨æ€ã£ã¦ã¾ã™ã€‚
æœ€è¿‘ã¡ã‚‡ã£ã¨é¢å€’ã ãªã£ã¦æ€ã£ãŸã®ãŒã€é–‹ç™ºæ®µéšã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã£ã¦ã›ã„ãœã„10ä»¶ãã‚‰ã„ãªã‚“ã§ã™ãŒã€æ‰‹æ‰“ã¡ã§ä½œæˆã™ã‚‹ã®ãŒé¢å€’ã ãªã£ã¦æ€ã£ãŸã‚“ã§ã™ã€‚
ä»Šå›ã¯ã€firestoreã«ä¸€æ‹¬ã§ãƒ‡ãƒ¼ã‚¿ã‚’ã¶ã¡è¾¼ã‚ã‚‹ã‚ˆã†ã«ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¨é€£æºã•ã›ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

# ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
ä»Šå›ã¯ã€ç°¡å˜ã«ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
é©å½“ã«10ä»¶ã»ã©ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«å…¥ã‚Œã¾ã™ã€‚
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2023-08-19 13.43.47.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/746815/16a8b6e5-61b8-5350-ee1e-774c37ef47ac.png)

# GASã®è¨­å®š
ã¾ãšã€firestoreã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’GASã«å…¥ã‚Œã¾ã™ã€‚
ã¾ãšã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€Œæ‹¡å¼µæ©Ÿèƒ½ã€ã‚¿ãƒ–ã‹ã‚‰`Apps Script`ã‚’é–‹ãã¾ã™ã€‚
ãã‚Œã§ã¯ã€GASã«firestoreã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚Œã¾ã™ã€‚
å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‹ã‚‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ¨ªã®ã€Œ+ã€ã‚’é¸æŠã—ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆIDæ¬„ã«ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒšã—ã¾ã™ã€‚
```
1VUSl4b1r1eoNcRWotZM3e87ygkxvXltOgyDZhixqncz9lQ3MjfT1iKFw
```
ãã®å¾Œã€ã€Œæ¤œç´¢ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã—ã¾ã™ã€‚ã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªç”»é¢ã«ãªã‚‹ã¨æ€ã†ã®ã§ã€ã€Œè¿½åŠ ã€ã‚’æŠ¼ä¸‹ã—ã¾ã™ã€‚
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2023-08-19 13.47.34.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/746815/6dc042c9-df59-eb29-0b22-f06d1f2a344b.png)

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸‹ã«ã€ã€ŒFirestoreAppã€ã¨è¡¨ç¤ºã•ã‚Œã‚Œã°OKã§ã™ï¼

# firebaseã‹ã‚‰ã‚‚ã‚ã‚‚ã‚å–å¾—
firebaseã®åˆæœŸè¨­å®šã€cloud firestoreã¯ã™ã§ã«è¨­å®šæ¸ˆã¿ã®å‰æã§é€²ã‚ã¦ã„ãã¾ã™ã€‚
â€»ã¾ã ã®æ–¹ã¯è¨­å®šã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼
ä¸‹è¨˜ã®URLã‹ã‚‰ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ã€jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã¦ãŠãã¾ã™ã€‚
https://console.cloud.google.com/projectselector2/iam-admin/serviceaccounts

è¨­å®šã¯ã»ã¼ä»»æ„ã§å…¥åŠ›ã™ã‚‹éƒ¨åˆ†ãŒã»ã¨ã‚“ã©ã§ã™ãŒã€ãƒ­ãƒ¼ãƒ«ã ã‘ã€ŒCloud Firestoreã€€ã‚ªãƒ¼ãƒŠãƒ¼ã€ã«ã—ã¦ãã ã•ã„ã€‚
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2023-08-19 14.41.43.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/746815/47a6d7b3-fc0f-b6ef-e5ed-a98bf445183d.png)

ä½œæˆã§ããŸã‚‰ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è©³ç´°ç”»é¢ > ã‚­ãƒ¼ã‚¿ãƒ– > ã€Œéµã‚’è¿½åŠ ã€ ã®é †ã§ã€ã‚­ãƒ¼ã‚’ä½œæˆã—ã¦ã€jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‰å®Œäº†ã§ã™ã€‚

# firestoreã«ãƒ‡ãƒ¼ã‚¿ã‚’ã¶ã¡è¾¼ã‚€
ã¾ãšã¯ã€firebaseã‹ã‚‰å¿…è¦ãªã‚­ãƒ¼ã‚’å–å¾—ã—ã¦ã€é–¢æ•°ã§å®šç¾©ã—ã¦ãŠãã¾ã™ã€‚
ã‚‚ã‚ã‚‚ã‚å–å¾—ã—ã¦ããŸjsonãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã«è¨˜è¼‰ãŒã‚ã‚Šã¾ã™ï¼
```
function firestoreCertification() {
  var certification = {
    "email": "<Your Project's Service Account>", 
    "key": "-----BEGIN PRIVATE KEY-----\n<Your Secret Key>\n-----END PRIVATE KEY-----\n",
    "projectId": "<Your Project's ID>"
  }
  return certification;
}
```

ã‚ã¨ã¯ã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã€åŠ å·¥ã—ã¦ã€ã¶ã¡è¾¼ã¿ã¾ã™ã€‚
```
function postData (){
  // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’å–å¾—
  var sheet = SpreadsheetApp.getActive().getSheetByName('ãƒ‡ãƒ¼ã‚¿');

  //Firestoreã¸ã®èªè¨¼ã®ãŸã‚ã®å¤‰æ•°ã‚’ç”¨æ„
  var certification = firestoreCertification();
  var firestore = FirestoreApp.getFirestore(certification.email, certification.key, certification.projectId);

  try {
    var lastname = sheet.getRange('A1:A10').getValues();
    var firstname = sheet.getRange('B1:B10').getValues();
    var age = sheet.getRange('C1:C10').getValues();
    var gender = sheet.getRange('D1:D10').getValues();

    // å–å¾—ã—ã¦ããŸãƒ‡ãƒ¼ã‚¿åˆ†ã ã‘forã§å›ã™
    for (let i = 0; i < lastname.length; i++) {
      var postdata = {
        /** è‹—å­— */
        lastname: lastname[i][0],
        /** åå‰ */
        firstname: firstname[i][0],
        /** å¹´é½¢ */
        age: age[i][0],
        /** æ€§åˆ¥ */
        gender: gender[i][0],
      }
      // userã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«documentã‚’ç™»éŒ²ã—ã¦ã„ã
      firestore.createDocument(`user/`, postdata);
    }
  } catch(e) {
    Logger.log(e)
  }
}
```

ä»Šå›ã¯ã€documentIdã‚’æŒ‡å®šã›ãšã«ã€ç™»éŒ²ã‚’ã—ã¦ã„ãã¾ã™ã€‚
ã‚³ãƒ¼ãƒ‰ã®å®Ÿè£…ãŒå®Œäº†ã—ãŸã‚‰ã€å®Ÿè¡Œã™ã‚‹é–¢æ•°ã‚’ã€ŒpostDataã€ã«è¨­å®šã—ã¦ã€ã€Œå®Ÿè¡Œã€ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

é–¢æ•°ã‚’å®Ÿè¡Œã—ã¦ã€firestoreã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2023-08-19 14.34.00.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/746815/0654d663-5c38-743b-b27a-6bc20a7df75c.png)


ç„¡äº‹ã€firestoreã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚
ä»Šå¾Œã¯ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ã‹ã¯ã“ã‚Œã§ä¸€æ‹¬ç™»éŒ²ã—ã¡ã‚ƒã£ãŸã‚‰ã‚ˆã•ãã†ã§ã™ã­ã€‚
å››æŠå•é¡Œã®ã‚¢ãƒ—ãƒªã¨ã‹ã€æœ€åˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹ã®ãŒé¢å€’ãªã‚“ã§ã€ãã‚Œã§ä½¿ã£ã¦ã¿ã¾ã™ã€‚

# çµ‚ã‚ã‚Šã«
ä»Šå›ã€ã“ã®åŠ¹ç‡åŒ–ã¯ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®å…ˆè¼©æ–¹ã®ã•ã¾ã–ã¾ãªè¨˜äº‹ãŒã‚ã£ã¦ã€å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚
è‰²ã€…è¨˜äº‹ãŒã‚ã£ãŸã‚“ã§ã™ãŒã€è‡ªåˆ†ã®å‚™å¿˜éŒ²ã¨ã—ã¦æ®‹ã—ã¦ãŠããŸã„ãƒ»ãƒ»ã¨æ€ã£ãŸã®ã§è¨˜äº‹ã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸï¼

ã“ã‚Œã§æ‰‹æ‰“ã¡ã›ãšã«æ¸ˆã¿ã¾ã™ã€‚ã¡ã‚‡ã£ã¨ä¾¿åˆ©ã«ãªã‚Šã¾ã—ãŸã€‚ä½•ã‹ã®ãŠå½¹ã«ç«‹ã¦ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚

# å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸè¨˜äº‹
https://qiita.com/_matuzaki/items/f6d43ff18f970f906357
https://qiita.com/masa-321/items/86e356b02dcf5b840595
