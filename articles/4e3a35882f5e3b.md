---
title: "ã€å¾Œç·¨ã€‘Next.jsã§ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Ÿè£…ã™ã‚‹ ã€œãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒˆãƒªã‚¬ãƒ¼ç·¨ã€œ"
emoji: "ğŸ•"
type: "tech"
topics:
  - "firebase"
  - "nextjs"
  - "reacthookform"
  - "chakraui"
  - "firebaseauth"
published: true
published_at: "2023-09-05 09:30"
---

# æ¦‚è¦
2è¨˜äº‹ã«æ¸¡ã£ã¦ã€Next.jsã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã«ã¤ã„ã¦å®Ÿè£…ã€è§£èª¬ã—ã¦ãã¾ã—ãŸãŒã€ã“ã®è¨˜äº‹ãŒæœ€å¾Œã®è¨˜äº‹ã«ãªã‚Šã¾ã™ï¼
å‰å›ã®è¨˜äº‹ã§ã€authå‘¨ã‚Šã®æœ€ä½é™ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ä»Šå›ã®è¨˜äº‹ã¯ã€ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›ãƒã‚§ãƒƒã‚¯ã‚„authå‘¨ã‚Šã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€~~authãƒˆãƒªã‚¬ãƒ¼ã®å®Ÿè£…~~ã®2ç‚¹ã‚’å®Ÿè£…ã€èª¬æ˜ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™
å‰ç·¨ chakra-uiÃ—react-hook-formç·¨

https://zenn.dev/ko_hei/articles/28e7709e187c0a

ä¸­ç·¨ firebase authenticationç·¨

https://zenn.dev/ko_hei/articles/4f47868cad4021

~~å¾Œç·¨ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒˆãƒªã‚¬ãƒ¼ç·¨~~
å¾Œç·¨ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç·¨

ãã‚Œã§ã¯å®Ÿè£…ã«ç§»ã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

# ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
react-hook-formã«ã¯ãƒ•ã‚©ãƒ¼ãƒ ã®å…¥åŠ›ãƒã‚§ãƒƒã‚¯ã‚’ã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚
ãã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã€ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒã‚§ãƒƒã‚¯ã‚’ã—ã¦ã€ãƒ«ãƒ¼ãƒ«ã«ä¹—ã£ã¦ã„ãªã„å ´åˆã€ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¦å‡¦ç†ã‚’å®Ÿè¡Œã§ããªã„ã‚ˆã†ã—ã¾ã—ã‚‡ã†ã€‚
ä»Šå›ã¯ã€ã‚ˆãã‚ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ï¼
- å¿…é ˆé …ç›®
- Emailã¯åŠè§’è‹±æ•°å­—
- Emailã®å½¢å¼(XXX@XXX.XXXï¼‰
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã®åŠè§’è‹±æ•°å­—
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«å¤§æ–‡å­—ã‚’1ã¤å«ã‚€
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ç¢ºèªç”¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¦ã„ã‚‹

ä»¥ä¸Š6ã¤ã®ãƒ«ãƒ¼ãƒ«ã‚’ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã«è¿½åŠ ã—ã¦ã„ãã¾ã™ï¼

## ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
```typescript: signin.tsx
'use client'
import NextLink from 'next/link'
import { useRouter } from 'next/navigation'
import { useState } from 'react'
import { useForm } from 'react-hook-form'

import {
  Button,
  Flex,
  FormControl,
  FormErrorMessage,
  FormLabel,
  Heading,
  Input,
  InputGroup,
  InputRightElement,
  useToast,
  VStack,
} from '@/common/design'
import { signInWithEmail } from '@/lib/firebase/apis/auth'

// ãƒ•ã‚©ãƒ¼ãƒ ã§ä½¿ç”¨ã™ã‚‹å¤‰æ•°ã®å‹ã‚’å®šç¾©
type formInputs = {
  email: string
  password: string
}

/** ã‚µã‚¤ãƒ³ã‚¤ãƒ³ç”»é¢
 * @screenname SignInScreen
 * @description ãƒ¦ãƒ¼ã‚¶ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’è¡Œã†ç”»é¢
 */
export default function SignInScreen() {
  const toast = useToast()
  const router = useRouter()
  const {
    handleSubmit,
    register,
    formState: { errors, isSubmitting },
  } = useForm<formInputs>()

  const [show, setShow] = useState<boolean>(false)

  const onSubmit = handleSubmit(async (data) => {
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯
    await signInWithEmail({
      email: data.email,
      password: data.password,
    }).then((res: boolean) => {
      if (res) {
        console.log('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ')
      } else {
        console.log('ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—')
      }
    })
  })
  return (
    <Flex
      flexDirection='column'
      width='100%'
      height='100vh'
      justifyContent='center'
      alignItems='center'
    >
      <VStack spacing='5'>
        <Heading>ãƒ­ã‚°ã‚¤ãƒ³</Heading>
        <form onSubmit={onSubmit}>
          <VStack spacing='4' alignItems='left'>
            <FormControl isInvalid={Boolean(errors.email)}>
              <FormLabel htmlFor='email' textAlign='start'>
                ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
              </FormLabel>
              <Input
                id='email'
                {...register('email', {
                  required: 'å¿…é ˆé …ç›®ã§ã™',
                  maxLength: {
                    value: 50,
                    message: '50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„',
                  },
                })}
              />
	      // ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
              <FormErrorMessage>
                {errors.email && errors.email.message}
              </FormErrorMessage>
            </FormControl>

            <FormControl isInvalid={Boolean(errors.password)}>
              <FormLabel htmlFor='password'>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</FormLabel>
              <InputGroup size='md'>
                <Input
                  pr='4.5rem'
                  type={show ? 'text' : 'password'}
                  {...register('password', {
                    required: 'å¿…é ˆé …ç›®ã§ã™',
                    minLength: {
                      value: 8,
                      message: '8æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„',
                    },
                    maxLength: {
                      value: 50,
                      message: '50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„',
                    },
                  })}
                />
                <InputRightElement width='4.5rem'>
                  <Button h='1.75rem' size='sm' onClick={() => setShow(!show)}>
                    {show ? 'Hide' : 'Show'}
                  </Button>
                </InputRightElement>
              </InputGroup>
	      // ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
              <FormErrorMessage>
                {errors.password && errors.password.message}
              </FormErrorMessage>
            </FormControl>
            <Button
              marginTop='4'
              color='white'
              bg='teal.400'
              isLoading={isSubmitting}
              type='submit'
              paddingX='auto'
              _hover={{
                borderColor: 'transparent',
                boxShadow: '0 7px 10px rgba(0, 0, 0, 0.3)',
              }}
            >
              ãƒ­ã‚°ã‚¤ãƒ³
            </Button>
            <Button
              as={NextLink}
              bg='white'
              color='black'
              href='/signup'
              width='100%'
              _hover={{
                borderColor: 'transparent',
                boxShadow: '0 7px 10px rgba(0, 0, 0, 0.3)',
              }}
            >
              æ–°è¦ç™»éŒ²ã¯ã“ã¡ã‚‰ã‹ã‚‰
            </Button>
          </VStack>
        </form>
      </VStack>
    </Flex>
  )
}
```
ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã§ã¯ã€Emailã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…±ã«å¿…é ˆå…¥åŠ›ã§ã€æœ€å¤§æ–‡å­—æ•°ãŒ50æ–‡å­—ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚
ãã—ã¦ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯8æ–‡å­—ä»¥ä¸Šã®å…¥åŠ›ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚
å¿…é ˆã®å…¥åŠ›ã®ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼ä¸‹è¨˜ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°OKã§ã™ï¼
ä»–ã®ã‚¨ãƒ©ãƒ¼ã‚‚è¡¨ç¤ºã•ã›ã¦ã¿ã¦ãã ã•ã„ï¼ï¼ˆç”»åƒã§ã®ç¢ºèªã¯å‰²æ„›ã—ã¾ã™ãƒ»ãƒ»ï¼‰
![](https://storage.googleapis.com/zenn-user-upload/a624bf2f6948-20230904.png)

## æ–°è¦ç™»éŒ²ç”»é¢
```typescript: signin.tsx
'use client'
import NextLink from 'next/link'
import { useRouter } from 'next/navigation'
import { useState } from 'react'
import { useForm } from 'react-hook-form'

import {
  Button,
  Flex,
  FormControl,
  FormErrorMessage,
  FormLabel,
  Heading,
  Input,
  InputGroup,
  InputRightElement,
  useToast,
  VStack,
} from '@/common/design'
import { signUpWithEmail } from '@/lib/firebase/apis/auth'

// ãƒ•ã‚©ãƒ¼ãƒ ã§ä½¿ç”¨ã™ã‚‹å¤‰æ•°ã®å‹ã‚’å®šç¾©
type formInputs = {
  email: string
  password: string
  confirm: string
}

/** ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ç”»é¢
 * @screenname SignUpScreen
 * @description ãƒ¦ãƒ¼ã‚¶ã®æ–°è¦ç™»éŒ²ã‚’è¡Œã†ç”»é¢
 */
export default function SignUpScreen() {
  const router = useRouter()
  const toast = useToast()
  const {
    handleSubmit,
    register,
    getValues,
    formState: { errors, isSubmitting },
  } = useForm<formInputs>()

  const [password, setPassword] = useState(false)
  const [confirm, setConfirm] = useState(false)

  const onSubmit = handleSubmit(async (data) => {
    await signUpWithEmail({
      email: data.email,
      password: data.password,
    }).then((res: boolean) => {
      if (res) {
        console.log('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ')
      } else {
        console.log('ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—')
      }
    })
  })

  const passwordClick = () => setPassword(!password)
  const confirmClick = () => setConfirm(!confirm)

  return (
    <Flex height='100vh' justifyContent='center' alignItems='center'>
      <VStack spacing='5'>
        <Heading>æ–°è¦ç™»éŒ²</Heading>
        <form onSubmit={onSubmit}>
          <VStack alignItems='left'>
            <FormControl isInvalid={Boolean(errors.email)}>
              <FormLabel htmlFor='email' textAlign='start'>
                ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
              </FormLabel>
              <Input
                id='email'
                {...register('email', {
                  required: 'å¿…é ˆé …ç›®ã§ã™',
                  maxLength: {
                    value: 50,
                    message: '50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„',
                  },
                  pattern: {
                    value:
                      /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@+[a-zA-Z0-9-]+\.+[a-zA-Z0-9-]+$/,
                    message: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒé•ã„ã¾ã™',
                  },
                })}
              />
	      // ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
              <FormErrorMessage>
                {errors.email && errors.email.message}
              </FormErrorMessage>
            </FormControl>

            <FormControl isInvalid={Boolean(errors.password)}>
              <FormLabel htmlFor='password'>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</FormLabel>
              <InputGroup size='md'>
                <Input
                  pr='4.5rem'
                  type={password ? 'text' : 'password'}
                  {...register('password', {
                    required: 'å¿…é ˆé …ç›®ã§ã™',
                    minLength: {
                      value: 8,
                      message: '8æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„',
                    },
                    maxLength: {
                      value: 50,
                      message: '50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„',
                    },
                    pattern: {
                      value: /^(?=.*[A-Z])[0-9a-zA-Z]*$/,
                      message:
                        'åŠè§’è‹±æ•°å­—ã‹ã¤å°‘ãªãã¨ã‚‚1ã¤ã®å¤§æ–‡å­—ã‚’å«ã‚ã¦ãã ã•ã„',
                    },
                  })}
                />
                <InputRightElement width='4.5rem'>
                  <Button h='1.75rem' size='sm' onClick={passwordClick}>
                    {password ? 'Hide' : 'Show'}
                  </Button>
                </InputRightElement>
              </InputGroup>
	      // ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
              <FormErrorMessage>
                {errors.password && errors.password.message}
              </FormErrorMessage>
            </FormControl>

            <FormControl isInvalid={Boolean(errors.confirm)}>
              <FormLabel htmlFor='confirm'>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª</FormLabel>
              <InputGroup size='md'>
                <Input
                  pr='4.5rem'
                  type={confirm ? 'text' : 'password'}
                  {...register('confirm', {
                    required: 'å¿…é ˆé …ç›®ã§ã™',
                    minLength: {
                      value: 8,
                      message: '8æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„',
                    },
                    maxLength: {
                      value: 50,
                      message: '50æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„',
                    },
                    pattern: {
                      value: /^(?=.*[A-Z])[0-9a-zA-Z]*$/,
                      message:
                        'åŠè§’è‹±æ•°å­—ã‹ã¤å°‘ãªãã¨ã‚‚1ã¤ã®å¤§æ–‡å­—ã‚’å«ã‚ã¦ãã ã•ã„',
                    },
                    validate: (value) =>
                      value === getValues('password') ||
                      'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“',
                  })}
                />
                <InputRightElement width='4.5rem'>
                  <Button h='1.75rem' size='sm' onClick={confirmClick}>
                    {confirm ? 'Hide' : 'Show'}
                  </Button>
                </InputRightElement>
              </InputGroup>
	      // ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
              <FormErrorMessage>
                {errors.confirm && errors.confirm.message}
              </FormErrorMessage>
            </FormControl>

            <Button
              marginTop='4'
              color='white'
              bg='teal.400'
              isLoading={isSubmitting}
              type='submit'
              paddingX='auto'
              _hover={{
                borderColor: 'transparent',
                boxShadow: '0 7px 10px rgba(0, 0, 0, 0.3)',
              }}
            >
              æ–°è¦ç™»éŒ²
            </Button>
          </VStack>
        </form>
        <Button
          as={NextLink}
          href='/signin'
          bg='white'
          width='100%'
          _hover={{
            borderColor: 'transparent',
            boxShadow: '0 7px 10px rgba(0, 0, 0, 0.3)',
          }}
        >
          ãƒ­ã‚°ã‚¤ãƒ³ã¯ã“ã¡ã‚‰ã‹ã‚‰
        </Button>
      </VStack>
    </Flex>
  )
}
```
æ–°è¦ç™»éŒ²ç”»é¢ã§ã¯ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å½¢å¼ã€ç¢ºèªç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹å…¥åŠ›è¦å‰‡ã‚’è¨­å®šã—ã¦ã¾ã™ã€‚â€»ãã‚Œä»¥å¤–ã¯ã€ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¨åŒã˜ãªã®ã§ã€å‰²æ„›ã—ã¾ã™ã€‚

### ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€åŠè§’è‹±æ•°å­—ã€è¨˜å·ã§å½¢æˆã•ã‚Œã¾ã™ã€‚ã¾ãŸã€ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼`xxx@xx.xx`ã®å½¢å¼ã§ãªã‘ã‚Œã°ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
```
/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@+[a-zA-Z0-9-]+\.+[a-zA-Z0-9-]+$/
```

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å½¢å¼ã¯ã€å¤§æ–‡å­—ã®è‹±å­—ãŒ1æ–‡å­—å…¥ã£ã¦ã„ã‚‹ã‹ã¤åŠè§’è‹±æ•°å­—ã§å…¥åŠ›ã—ãªã‘ã‚Œã°ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
```
/^(?=.*[A-Z])[0-9a-zA-Z]*$/
```

### ç¢ºèªç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
ç¢ºèªç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¬„ã¨ã€ç¢ºèªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’èª¿ã¹ã¾ã™ã€‚
```
// getValuesã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
const {
  handleSubmit,
  register,
  getValues,
  formState: { errors, isSubmitting },
} = useForm<formInputs>()
..çœç•¥..
// ç¢ºèªç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®1ã¤
validate: (value) => value === getValues('password') ||
                      'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“',
```

### å…¨ã¦ã®ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º
ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼ä¸‹è¨˜ã®ã‚ˆã†ã«3ã¤ã®ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸï¼
ã“ã‚Œã§ã€å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¨­å®šã§ãã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/72efea70083c-20230904.png)

â€» ç´°ã‹ã„è¨­å®šãªã©è¿½åŠ ã‚’ã—ã¦ã„ã¾ã™ãŒã€å…¥åŠ›è¦å‰‡å‘¨ã‚Šã‚’ä¸­å¿ƒã«è§£èª¬ã‚’ã—ã¾ã—ãŸã€‚`isLoading={isSubmitting}`ã€`isInvalid={Boolean(errors.email)}`ãªã©ã¯ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ã¿ã¦ãã ã•ã„ã€‚

# authå‘¨ã‚Šã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
ç¾çŠ¶ã®authã®è¨­å®šã§ã¯ã€ã„ãã¤ã‹çµæœãŒã‚¨ãƒ©ãƒ¼ã§è¿”ã£ã¦ãã‚‹ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚
ä¾‹ãˆã°ã€ãƒ­ã‚°ã‚¤ãƒ³ã ã¨ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¦ã„ãªã„ã‚„ãƒ¦ãƒ¼ã‚¶æƒ…å ±ãŒãªã„ãªã©ã®ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚
æ–°è¦ç™»éŒ²ã§ã¯ã€ã™ã§ã«ãƒ¦ãƒ¼ã‚¶ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ãŒæŒ™ã’ã‚‰ã‚Œã‚‹ã¾ã™ã€‚ã“ã‚Œã‚’å…¨ã¦åŒã˜ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦è¿”ã™ã¨ãƒ¦ãƒ¼ã‚¶ã¯ä½•ã®ã‚¨ãƒ©ãƒ¼ãªã®ã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚
ãã®ãŸã‚ã€firebase authã‹ã‚‰è¿”ã£ã¦ãã‚‹ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã§ãƒ¦ãƒ¼ã‚¶ã«å¯¾ã—ã¦ã€ã©ã†ã„ã£ãŸã‚¨ãƒ©ãƒ¼ã ã‚ˆã£ã¦è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ã—ã¦ã„ãã¾ã™ã€‚

`auth.ts`ã®ãã‚Œãã‚Œã®å‡¦ç†ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›´æ–°ã—ã¾ã™ã€‚
```typescript
import {
  createUserWithEmailAndPassword, GoogleAuthProvider, signInWithEmailAndPassword, signInWithPopup,
  signOut
} from 'firebase/auth';

import { auth } from '@/lib/config';

/** firebaseã®å‡¦ç†çµæœ */
export type FirebaseResult = {
  isSuccess: boolean
  message: string
}

/** firebaseã®ã‚¨ãƒ©ãƒ¼ */
type FirebaseError = {
  code: string
  message: string
  name: string
}

const isFirebaseError = (e: Error): e is FirebaseError => {
  return 'code' in e && 'message' in e
}

/**
 * Emailã¨Passwordã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³
 * @param email
 * @param password
 * @returns Promise<FirebaseResult>
 */
export const signInWithEmail = async (args: {
  email: string
  password: string
}): Promise<FirebaseResult> => {
  let result: FirebaseResult = { isSuccess: false, message: '' }
  try {
    const user = await signInWithEmailAndPassword(
      auth,
      args.email,
      args.password
    )

    if (user) {
      result = { isSuccess: true, message: 'ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸã—ã¾ã—ãŸ' }
    }
  } catch (error) {
    if (
      error instanceof Error &&
      isFirebaseError(error) &&
      error.code === 'auth/user-not-found'
    ) {
      result = { isSuccess: false, message: 'ãƒ¦ãƒ¼ã‚¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ' }
    } else if (
      error instanceof Error &&
      isFirebaseError(error) &&
      error.code === 'auth/wrong-password'
    ) {
      result = { isSuccess: false, message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™' }
    } else {
      result = { isSuccess: false, message: 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ' }
    }
  }
  return result
}

/**
 * Emailã¨Passwordã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—
 * @param username
 * @param email
 * @param password
 * @returns Promise<FirebaseResult>
 */
export const signUpWithEmail = async (args: {
  email: string
  password: string
}): Promise<FirebaseResult> => {
  let result: FirebaseResult = { isSuccess: false, message: '' }
  try {
    const user = await createUserWithEmailAndPassword(
      auth,
      args.email,
      args.password
    )
    if (user) {
      result = { isSuccess: true, message: 'æ–°è¦ç™»éŒ²ã«æˆåŠŸã—ã¾ã—ãŸ' }
    }
  } catch (error) {
    if (
      error instanceof Error &&
      isFirebaseError(error) &&
      error.code === 'auth/email-already-in-use'
    ) {
      result = {
        isSuccess: false,
        message: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™',
      }
    } else {
      result = { isSuccess: false, message: 'æ–°è¦ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ' }
    }
  }
  return result
}

/**
 * ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
 * @returns Promise<FirebaseResult>
 */
export const logout = async (): Promise<FirebaseResult> => {
  let result: FirebaseResult = { isSuccess: false, message: '' }

  await signOut(auth)
    .then(() => {
      result = { isSuccess: true, message: 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ' }
    })
    .catch((error) => {
      result = { isSuccess: false, message: error.message }
    })

  return result
}
```

### 1. è¿”ã‚Šå€¤ã‚’å¤‰æ›´
ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”ã‚Šå€¤ã‚’`boolean`ã‹ã‚‰å‡¦ç†çµæœ`boolean`ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸`string`ã«å¤‰æ›´ã—ã¾ã™ã€‚
ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ç”»é¢å´ã§ã¯å‡¦ç†çµæœã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ã‚’åˆ†å²ã•ã›ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã§è¡¨ç¤ºã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ç”»é¢å´
```typescript
await signInWithEmail({
email: data.email,
password: data.password,
}).then((res: FirebaseResult) => {
  if (res.isSuccess) {
    toast({
      title: res.message,
      status: 'success',
      duration: 2000,
      isClosable: true,
    })
  } else {
      toast({
        title: res.message, 
        status: 'error',
        duration: 2000,
        isClosable: true,
      })
  }
})
```
â€»ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã¯ä¸‹è¨˜ã®URLã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ï¼

https://chakra-ui.com/docs/components/toast

### 2. æ–°è¦ç™»éŒ²ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
æ–°è¦ç™»éŒ²ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚
æ–°è¦ç™»éŒ²ã®å ´åˆã«è€ƒãˆã‚‰ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦ã¯ã€ã™ã§ã«ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚
ãã®ãŸã‚ã€`auth/email-already-in-use`ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å—ã‘ã¨ã‚‹ã¨è©²å½“ã—ã¾ã™ã€‚
â€»ãã‚Œä»¥å¤–ã§ä½•ã‚‰ã‹ã®ä¸å…·åˆã§æ–°è¦ç™»éŒ²ã§ããªã‹ã£ãŸå ´åˆã«ã€Œæ–°è¦ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã•ã›ã¾ã™ã€‚
```typescript
if (
  error instanceof Error &&
  isFirebaseError(error) &&
  error.code === 'auth/email-already-in-use'
) {
  result = {
    isSuccess: false,
    message: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™',
  }
} else {
  result = { isSuccess: false, message: 'æ–°è¦ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ' }
}
```

### 3. ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
æ¬¡ã«ãƒ­ã‚°ã‚¤ãƒ³ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚
ãƒ­ã‚°ã‚¤ãƒ³ã®å ´åˆã«è€ƒãˆã‚‰ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦ã¯ã€ä¸€è‡´ã™ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãªã„ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹ã®2ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚
ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã¯ã€`auth/user-not-found`ã¨`auth/wrong-password`ã§ã™ã€‚
â€»ãã‚Œä»¥å¤–ã§ä½•ã‚‰ã‹ã®ä¸å…·åˆã§ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã‹ã£ãŸå ´åˆã«ã€Œãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã•ã›ã¾ã™ã€‚
```typescript
if (
  error instanceof Error &&
  isFirebaseError(error) &&
  error.code === 'auth/user-not-found'
) {
    result = { isSuccess: false, message: 'ãƒ¦ãƒ¼ã‚¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ' }
  } else if (
    error instanceof Error &&
    isFirebaseError(error) &&
    error.code === 'auth/wrong-password'
  ) {
    result = { isSuccess: false, message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™' }
  } else {
    result = { isSuccess: false, message: 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ' }
  }
}
```

### 4. ã‚¨ãƒ©ãƒ¼ã®è¡¨ç¤º
æœ€å¾Œã«ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèªã—ã¦ã¾ã—ã‚‡ã†ï¼

`auth/email-already-in-use`ãƒ‘ã‚¿ãƒ¼ãƒ³
ç¾åœ¨ã¯ã“ã®ãƒ¦ãƒ¼ã‚¶ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/7d92a0cd33ff-20230904.png)
ä¸‹è¨˜ã®æƒ…å ±ã§ã€æ–°è¦ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/ba404008b029-20230904.png)
ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸï¼æ–°è¦ç™»éŒ²ã¯OKã§ã™ï¼
![](https://storage.googleapis.com/zenn-user-upload/03f45f3ed309-20230904.png)

ãƒ­ã‚°ã‚¤ãƒ³ã«ã¤ã„ã¦ã‚‚ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼
`auth/user-not-found`ãƒ‘ã‚¿ãƒ¼ãƒ³
`auth_testuser_02@test.com`ã®ãƒ¦ãƒ¼ã‚¶ã¯ã„ãªã„ã®ã§ã€ä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/6bd7e64c36aa-20230904.png)

`auth/wrong-password`ãƒ‘ã‚¿ãƒ¼ãƒ³
ç™»éŒ²æ™‚ã«ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã¯`Password`ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ãŸã®ã§ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸï¼
![](https://storage.googleapis.com/zenn-user-upload/836eca192ae1-20230904.png)

ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚‚ã“ã‚Œã§OKã§ã™ï¼ã“ã‚Œã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Ÿè£…ã¯å®Œäº†ã§ã™ï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼

# çµ‚ã‚ã‚Šã«
ä»Šå›ã¯ã€å…¨3ç·¨ã«åˆ†ã‘ã¦ã€Next.jsã¨Firebaseã€Chakra-uiã€react-hook-formã®4ã¤ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ãŸãƒ­ã‚°ã‚¤ãƒ³ã€æ–°è¦ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Ÿè£…ã—ã¾ã—ãŸï¼
ã‚¢ãƒ—ãƒªé–‹ç™ºå½“åˆã¯æ­£å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‡¦ç†ã«ã—ã‹ç›®ãŒã„ãã¾ã›ã‚“ã§ã—ãŸãŒã€æœ€è¿‘ã¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚‚å¤§åˆ‡ã ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚
æœ¬å½“ã¯å¾Œç·¨ã§authã«ãƒ¦ãƒ¼ã‚¶ã‚’æ–°è¦ç™»éŒ²ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒˆãƒªã‚¬ãƒ¼ã‚’å®Ÿè£…ã—ã€cloudfirestoreã«ã‚‚è¿½åŠ ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€æ€ã„ã®ã»ã‹é•·ããªã£ã¦ã—ã¾ã£ãŸã®ã§ã€ã¾ãŸæ¬¡ã®æ©Ÿä¼šã«è¨˜äº‹ã‚’æŠ•ç¨¿ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ï¼
ã“ã“ã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼é–“é•ã„ç­‰ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€ã”æŒ‡æ‘˜ã®æ–¹ã‚’ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼ï¼